"""
冷却水温度修正系数模块
"""

# 30-120 °F 对应水温修正系数
_TEMP_FW = [
    30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
    50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
    70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
    90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
    110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120
]
_COEFF = [
    0.650, 0.659, 0.669, 0.678, 0.687, 0.696, 0.706, 0.715, 0.724, 0.733, 0.743, 0.752, 0.761, 0.770, 0.780, 0.789,
    0.798, 0.807, 0.816, 0.825, 0.834, 0.843, 0.852, 0.861, 0.870, 0.879, 0.888, 0.897, 0.905, 0.914, 0.923, 0.932,
    0.941, 0.950, 0.959, 0.968, 0.975, 0.982, 0.989, 0.994, 1.000, 1.005, 1.010, 1.015, 1.020, 1.025, 1.029, 1.033,
    1.037, 1.041, 1.045, 1.048, 1.051, 1.054, 1.057, 1.060, 1.063, 1.066, 1.069, 1.072, 1.075, 1.078, 1.080, 1.083,
    1.085, 1.088, 1.090, 1.092, 1.095, 1.097, 1.100, 1.103, 1.105, 1.108, 1.110, 1.113, 1.115, 1.117, 1.119, 1.121,
    1.123, 1.125, 1.127, 1.129, 1.131, 1.133, 1.135, 1.137, 1.139, 1.141, 1.143
]

# 常量
_MIN_F = _TEMP_FW[0]
_MAX_F = _TEMP_FW[-1]
_MIN_C = round((_MIN_F - 32) * 5 / 9, 1)
_MAX_C = round((_MAX_F - 32) * 5 / 9, 1)


def _c2f(c):
    """摄氏度转华氏度"""
    return c * 9 / 5 + 32


def _linear_interp(x, x_list, y_list):
    """线性插值"""
    if x <= x_list[0]:
        return y_list[0]
    if x >= x_list[-1]:
        return y_list[-1]
    
    for i in range(len(x_list) - 1):
        if x_list[i] <= x <= x_list[i + 1]:
            t = (x - x_list[i]) / (x_list[i + 1] - x_list[i])
            return y_list[i] + t * (y_list[i + 1] - y_list[i])
    return y_list[-1]


def water_correction_factor(t_celsius):
    """
    冷却水进水温度(°C) -> 水温修正系数
    有效温度范围：30-120 °F -> 约 -1.1-48.9 °C

    参数:
        t_celsius: 冷却水进水温度 (°C)
    返回:
        float: 水温修正系数（4位小数）
    """
    # 类型校验
    if not isinstance(t_celsius, (int, float)):
        raise TypeError(f"温度必须为数值类型")

    # 单位转换
    t_f = _c2f(t_celsius)

    # 范围校验
    if not (_MIN_F <= t_f <= _MAX_F):
        raise ValueError(
            f"温度超出范围！°C范围：[{_MIN_C}, {_MAX_C}]，当前：{t_celsius}°C"
        )

    # 线性插值
    coeff = _linear_interp(t_f, _TEMP_FW, _COEFF)
    return round(coeff, 4)


if __name__ == "__main__":
    print(water_correction_factor(32))
